import{u as f,s as y,x,y as v,f as F,_ as k,h as n,o as h,c as g,a as l,b as r,d as t,k as p,q as V,n as N}from"./app-CUJ9P7mJ.js";class P{constructor(){this.errors={}}has(e){return this.errors.hasOwnProperty(e)}any(){return Object.keys(this.errors).length>0}get(e){if(this.errors[e])return this.errors[e][0]}getFlash(e){if(this.errors[e])return this.errors[e]}record(e){this.errors=e}clear(e){if(e){this.has(e)&&delete this.errors[e];return}this.errors={}}}function U(o){if(o&&o instanceof Array&&o.length>0){const _=f().roles,w=o;return _.some(s=>w.includes(s))}else return console.error(`Need roles! Like v-role="['admin','editor']"`),!1}const C={data(){return{showPasswordModal:!1,passwordForm:{password:"",password_confirmation:""},form:{name:"",email:""},errors:new P}},computed:{...y(f,["id"]),...x(f,["name"])},methods:{...v(f,["$patch"]),checkRole:U,csrf:F,changePassword(){axios.post("/api/admin/user/"+this.id+"/change-password",this.passwordForm).then(o=>{this.$message({message:o.data,type:"success"}),this.showPasswordModal=!1,this.passwordForm.password="",this.passwordForm.password_confirmation=""}).catch(o=>{this.errors.record(o.response.data.errors)})},onSubmit(){axios.post("/api/admin/user/"+this.id+"/update",this.form).then(o=>{this.$patch([this.name=o.data.name]),this.$message({message:"Ваши данные изменены",type:"success"})}).catch(o=>{this.errors.record(o.response.data.errors)})},getUser(){axios.get("/api/admin/user/"+this.id+"/show").then(o=>{this.form=o.data,this.form.referral_url="https://t.me/TOP_iBot?start="+this.form.referral_token})}},mounted(){this.getUser()}},M={class:"row"},B={class:"row align-items-end"},R={key:0,class:"col-md-6",style:{"margin-bottom":"22px"}},S={class:"row"},q={slot:"footer",class:"dialog-footer"};function E(o,e,_,w,s,i){const m=n("el-input"),d=n("el-form-item"),u=n("el-button"),c=n("el-form"),b=n("el-dialog");return h(),g("section",null,[l("section",null,[r(c,{class:"disabled-form",model:s.form,"label-position":"top",disabled:!i.checkRole(["admin"])},{default:t(()=>[l("div",M,[r(d,{class:"col-md-6",label:"Имя",error:s.errors.get("name")},{default:t(()=>[r(m,{modelValue:s.form.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.form.name=a)},null,8,["modelValue"])]),_:1},8,["error"]),r(d,{class:"col-md-6",label:"E-mail",error:s.errors.get("email")},{default:t(()=>[r(m,{modelValue:s.form.email,"onUpdate:modelValue":e[1]||(e[1]=a=>s.form.email=a)},null,8,["modelValue"])]),_:1},8,["error"])]),l("div",B,[i.checkRole(["admin"])?(h(),g("div",R,[r(u,{icon:"el-icon-unlock",type:"primary",onClick:e[2]||(e[2]=a=>s.showPasswordModal=!0)},{default:t(()=>e[7]||(e[7]=[p("Сменить пароль")])),_:1})])):V("",!0)]),i.checkRole(["admin"])?(h(),N(u,{key:0,type:"success",onClick:i.onSubmit},{default:t(()=>e[8]||(e[8]=[p("Сохранить")])),_:1},8,["onClick"])):V("",!0)]),_:1},8,["model","disabled"]),r(b,{modelValue:s.showPasswordModal,"onUpdate:modelValue":e[6]||(e[6]=a=>s.showPasswordModal=a),title:"Сменить пароль"},{default:t(()=>[r(c,{model:s.passwordForm,"label-position":"top"},{default:t(()=>[l("div",S,[r(d,{class:"col-md-6",label:"Новый пароль",error:s.errors.get("password")},{default:t(()=>[r(m,{modelValue:s.passwordForm.password,"onUpdate:modelValue":e[3]||(e[3]=a=>s.passwordForm.password=a),"show-password":""},null,8,["modelValue"])]),_:1},8,["error"]),r(d,{class:"col-md-6",label:"Подтверждение пароля"},{default:t(()=>[r(m,{modelValue:s.passwordForm.password_confirmation,"onUpdate:modelValue":e[4]||(e[4]=a=>s.passwordForm.password_confirmation=a),"show-password":""},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"]),l("span",q,[r(u,{onClick:e[5]||(e[5]=a=>s.showPasswordModal=!1)},{default:t(()=>e[9]||(e[9]=[p("Отмена")])),_:1}),r(u,{type:"success",onClick:i.changePassword},{default:t(()=>e[10]||(e[10]=[p("Сохранить")])),_:1},8,["onClick"])])]),_:1},8,["modelValue"])])])}const O=k(C,[["render",E]]),A={components:{userInformation:O},data(){return{activeName:"main-information"}},watch:{activeName(o){this.$router.push(`${this.$route.path}?tab=${o}`)}},created(){const o=this.$route.query.tab;o&&(this.activeName=o)}},T={class:"custom-tabs-label"};function j(o,e,_,w,s,i){const m=n("User"),d=n("el-icon"),u=n("user-information"),c=n("el-tab-pane"),b=n("el-tabs");return h(),g("section",null,[e[2]||(e[2]=l("h1",{class:"page-title"},"Профиль пользователя",-1)),r(b,{type:"border-card",modelValue:s.activeName,"onUpdate:modelValue":e[0]||(e[0]=a=>s.activeName=a)},{default:t(()=>[r(c,{name:"main-information"},{label:t(()=>[l("span",T,[r(d,{style:{"margin-right":"5px"},size:16},{default:t(()=>[r(m)]),_:1}),e[1]||(e[1]=l("span",null," Основная информация",-1))])]),default:t(()=>[r(u)]),_:1})]),_:1},8,["modelValue"])])}const I=k(A,[["render",j]]);export{I as default};
